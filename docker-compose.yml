services:
  cortex:
    image: ghcr.io/rikouu/cortex:latest
    # For local development, replace above with:
    #   build: .
    ports:
      - "21100:21100"
    volumes:
      - cortex-data:/app/cortex
      # Mount docker socket + compose file for one-click update
      - /var/run/docker.sock:/var/run/docker.sock
      - /opt/cortex/docker-compose.yml:/app/docker-compose.yml:ro
      # Docker auth for pulling private GHCR images
      - /home/rigouu/.docker/config.json:/root/.docker/config.json:ro
    environment:
      - CORTEX_PORT=21100
      - CORTEX_HOST=0.0.0.0
      - CORTEX_DB_PATH=cortex/brain.db
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - CORTEX_AUTH_TOKEN=${CORTEX_AUTH_TOKEN:-}
      - LOG_LEVEL=info
      - TZ=Asia/Tokyo
    restart: unless-stopped

volumes:
  cortex-data:
