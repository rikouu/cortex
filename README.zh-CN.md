# ğŸ§  Cortex â€” é€šç”¨ AI Agent è®°å¿†æœåŠ¡

[English](./README.md) | **ä¸­æ–‡**

Cortex è®©ä½ çš„ AI æ‹¥æœ‰**æŒä¹…è®°å¿†**ã€‚å®ƒä»¥ Sidecar è¿›ç¨‹è¿è¡Œåœ¨ Agent æ—è¾¹ï¼Œè‡ªåŠ¨è®°ä½å¯¹è¯å†…å®¹ã€æå–å…³é”®äº‹å®ï¼Œå¹¶åœ¨éœ€è¦æ—¶å¬å›ç›¸å…³ä¸Šä¸‹æ–‡ã€‚

> **ä½ çš„ AI èƒ½è®°ä½ä½ ä¸Šå‘¨ã€ä¸Šä¸ªæœˆã€ç”šè‡³å»å¹´å‘Šè¯‰å®ƒçš„äº‹æƒ… â€” è·¨ä¼šè¯ã€è·¨è®¾å¤‡ã€‚**

---

## ç‰¹æ€§

- **ä¸‰å±‚è®°å¿†** â€” å·¥ä½œå±‚ï¼ˆ48hï¼‰â†’ æ ¸å¿ƒå±‚ï¼ˆæ°¸ä¹…ï¼‰â†’ å½’æ¡£å±‚ï¼ˆ90å¤©ï¼Œå‹ç¼©å›æµæ ¸å¿ƒå±‚ï¼‰
- **åŒé€šé“æå–** â€” å¿«é€Ÿæ­£åˆ™ + æ·±åº¦ LLM æå–å¹¶è¡Œè¿è¡Œ
- **20 ç§è®°å¿†åˆ†ç±»** â€” èº«ä»½ã€åå¥½ã€çº¦æŸã€Agent äººè®¾ç­‰
- **æ··åˆæœç´¢** â€” BM25 å…³é”®è¯ + å‘é‡è¯­ä¹‰æœç´¢ï¼ŒRRF èåˆ
- **æŸ¥è¯¢æ‰©å±•** â€” LLM ç”Ÿæˆæœç´¢å˜ä½“ï¼Œæé«˜å¬å›ç‡ï¼ˆå¯é€‰ï¼‰
- **LLM é‡æ’åº** â€” ç”¨ LLM å¯¹æœç´¢ç»“æœç²¾æ’ï¼Œæé«˜ç›¸å…³æ€§ï¼ˆå¯é€‰ï¼‰
- **å®ä½“å…³ç³»** â€” è‡ªåŠ¨æå–çŸ¥è¯†å›¾è°±ï¼ˆè°ç”¨ä»€ä¹ˆã€è°è®¤è¯†è°ï¼‰
- **æ™ºèƒ½å»é‡** â€” ä¸‰çº§åŒ¹é…é˜²æ­¢é‡å¤è®°å¿†
- **å¤šæä¾›å•†** â€” OpenAIã€Anthropicã€Google Geminiã€DeepSeekã€OpenRouterã€Ollama
- **å¤šæ™ºèƒ½ä½“** â€” æ¯ä¸ªæ™ºèƒ½ä½“ç‹¬ç«‹é…ç½®è¦†ç›–ï¼Œéš”ç¦»çš„è®°å¿†å‘½åç©ºé—´
- **ç®¡ç†é¢æ¿** â€” å®Œæ•´ç®¡ç† UIï¼Œå«æœç´¢è°ƒè¯•ã€ç”Ÿå‘½å‘¨æœŸé¢„è§ˆã€æå–æ—¥å¿—
- **é›¶é…ç½®** â€” åªéœ€ä¸€ä¸ª OpenAI API Key å³å¯å¼€ç®±å³ç”¨

---

## 30 ç§’ä¸Šæ‰‹

**å‰ææ¡ä»¶**ï¼šNode.js â‰¥ 20ï¼Œä¸€ä¸ª OpenAI API Keyï¼ˆæˆ–ä»»ä½•[æ”¯æŒçš„æä¾›å•†](#æ”¯æŒçš„æä¾›å•†)ï¼‰

```bash
git clone https://github.com/rikouu/cortex.git
cd cortex && pnpm install
cp .env.example .env        # å¡«å…¥ä½ çš„ OPENAI_API_KEY
pnpm dev                     # è¿è¡Œåœ¨ http://localhost:21100
```

æˆ–è€…ç”¨ Dockerï¼ˆä¸€è¡Œå‘½ä»¤ï¼‰ï¼š

```bash
OPENAI_API_KEY=sk-xxx docker compose up -d
```

æ‰“å¼€ http://localhost:21100 â€” ä½ ä¼šçœ‹åˆ°ç®¡ç†é¢æ¿ã€‚

---

## è¿æ¥ä½ çš„ AI

é€‰æ‹©ä½ çš„æ–¹å¼ï¼Œæ¯ç§éƒ½ä¸è¶…è¿‡ 2 åˆ†é’Ÿã€‚

### æ–¹å¼ Aï¼šClaude Desktopï¼ˆMCPï¼‰

1. æ‰“å¼€ Claude Desktop â†’ **è®¾ç½®** â†’ **å¼€å‘è€…** â†’ **ç¼–è¾‘é…ç½®**
2. ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼Œä¿å­˜ï¼Œç„¶å**ä»èœå•æ å®Œå…¨é€€å‡ºå¹¶é‡å¯** Claude Desktopï¼š

```json
{
  "mcpServers": {
    "cortex": {
      "command": "npx",
      "args": ["cortex-mcp", "--server-url", "http://localhost:21100"],
      "env": {
        "CORTEX_AGENT_ID": "default"
      }
    }
  }
}
```

3. å¼€å§‹æ–°å¯¹è¯ï¼Œå¯¹ AI è¯´ï¼š*"ä½ è¿˜è®°å¾—å…³äºæˆ‘çš„ä»€ä¹ˆï¼Ÿ"*

### æ–¹å¼ Bï¼šCursorï¼ˆMCPï¼‰

1. æ‰“å¼€ Cursor â†’ **è®¾ç½®** â†’ **MCP** â†’ **+ æ·»åŠ æ–°çš„å…¨å±€ MCP æœåŠ¡å™¨**
2. ç²˜è´´ä»¥ä¸‹å†…å®¹å¹¶ä¿å­˜ï¼š

```json
{
  "mcpServers": {
    "cortex": {
      "command": "npx",
      "args": ["cortex-mcp"],
      "env": {
        "CORTEX_URL": "http://localhost:21100",
        "CORTEX_AGENT_ID": "default"
      }
    }
  }
}
```

### æ–¹å¼ Cï¼šClaude Codeï¼ˆMCPï¼‰

åœ¨ç»ˆç«¯è¿è¡Œï¼š

```bash
claude mcp add cortex -- npx cortex-mcp --server-url http://localhost:21100
```

### æ–¹å¼ Dï¼šå…¶ä»– MCP å®¢æˆ·ç«¯

ä»»ä½•å…¼å®¹ MCP çš„åº”ç”¨ï¼ˆWindsurfã€Cline ç­‰ï¼‰ï¼Œå°†ä»¥ä¸‹é…ç½®æ·»åŠ åˆ°å®¢æˆ·ç«¯çš„ MCP é…ç½®æ–‡ä»¶ä¸­ï¼š

```json
{
  "mcpServers": {
    "cortex": {
      "command": "npx",
      "args": ["cortex-mcp", "--server-url", "http://localhost:21100"],
      "env": {
        "CORTEX_AGENT_ID": "default"
      }
    }
  }
}
```

å…·ä½“é…ç½®æ–‡ä»¶ä½ç½®å› å®¢æˆ·ç«¯è€Œå¼‚ï¼Œè¯·æŸ¥é˜…ä½ æ‰€ç”¨å®¢æˆ·ç«¯çš„æ–‡æ¡£ã€‚

### æ–¹å¼ Eï¼šOpenClaw

æŸ¥çœ‹å®Œæ•´çš„æ‰‹æŠŠæ‰‹æ•™ç¨‹ï¼š**[OpenClaw å¿«é€Ÿä¸Šæ‰‹](#openclaw-å¿«é€Ÿä¸Šæ‰‹)**ã€‚

### æ–¹å¼ Fï¼šä»»æ„åº”ç”¨ï¼ˆREST APIï¼‰

```bash
# å­˜å‚¨è®°å¿†
curl -X POST http://localhost:21100/api/v1/ingest \
  -H "Content-Type: application/json" \
  -d '{"user_message":"æˆ‘å–œæ¬¢åƒå¯¿å¸","assistant_message":"è®°ä½äº†ï¼","agent_id":"default"}'

# æ£€ç´¢è®°å¿†
curl -X POST http://localhost:21100/api/v1/recall \
  -H "Content-Type: application/json" \
  -d '{"query":"æˆ‘å–œæ¬¢åƒä»€ä¹ˆï¼Ÿ","agent_id":"default"}'
```

### éªŒè¯æ˜¯å¦ç”Ÿæ•ˆ

å‘Šè¯‰ä½ çš„ AI ä¸€äº›å€¼å¾—è®°ä½çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚ *"æˆ‘æœ€å–œæ¬¢çš„é¢œè‰²æ˜¯è“è‰²"*ï¼‰ã€‚ç„¶åå¼€ä¸€ä¸ª**æ–°å¯¹è¯**ï¼Œé—® *"æˆ‘æœ€å–œæ¬¢ä»€ä¹ˆé¢œè‰²ï¼Ÿ"*ã€‚å¦‚æœå›ç­”æ­£ç¡®ï¼Œè¯´æ˜ Cortex å·²ç»åœ¨å·¥ä½œäº†ã€‚

---

## OpenClaw å¿«é€Ÿä¸Šæ‰‹

ä¸€ä»½é¢å‘æ–°æ‰‹çš„å®Œæ•´æ•™ç¨‹ï¼Œè®©ä½ çš„ OpenClaw æ™ºèƒ½ä½“æ‹¥æœ‰æŒä¹…è®°å¿†ã€‚

### ä½ å°†è·å¾—ä»€ä¹ˆ

å®Œæˆä»¥ä¸‹æ­¥éª¤åï¼Œä½ çš„ OpenClaw æ™ºèƒ½ä½“å°†ï¼š
- æ¯æ¬¡å›å¤å‰è‡ªåŠ¨**å¬å›**ç›¸å…³è®°å¿†
- å¯¹è¯ç»“æŸåè‡ªåŠ¨**ä¿å­˜**é‡è¦ä¿¡æ¯
- ä¸Šä¸‹æ–‡å‹ç¼©å‰**ç´§æ€¥ä¿å­˜**å…³é”®ä¿¡æ¯
- å¯éšæ—¶ä½¿ç”¨ `cortex_recall` å’Œ `cortex_remember` å·¥å…·

### ç¬¬ 1 æ­¥ï¼šå¯åŠ¨ Cortex

å¦‚æœè¿˜æ²¡æœ‰è¿è¡Œ Cortexï¼Œå…ˆå¯åŠ¨å®ƒï¼š

```bash
# æ–¹å¼ Aï¼šä»æºç è¿è¡Œ
git clone https://github.com/rikouu/cortex.git
cd cortex && pnpm install
cp .env.example .env     # å¡«å…¥ä½ çš„ OPENAI_API_KEY
pnpm dev

# æ–¹å¼ Bï¼šDockerï¼ˆä¸€è¡Œå‘½ä»¤ï¼‰
OPENAI_API_KEY=sk-xxx docker compose up -d
```

éªŒè¯æ˜¯å¦åœ¨è¿è¡Œï¼š
```bash
curl http://localhost:21100/api/v1/health
# åº”è¿”å›ï¼š{"status":"ok", ...}
```

### ç¬¬ 2 æ­¥ï¼šå®‰è£…æ’ä»¶

```bash
openclaw plugins install @cortexmem/cortex-bridge
```

å°±è¿™æ ·ï¼Œä¸éœ€è¦é…ç½®æ–‡ä»¶ï¼Œä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®ã€‚

### ç¬¬ 3 æ­¥ï¼šå‘Šè¯‰æ’ä»¶ Cortex åœ¨å“ªé‡Œ

ä»¥ä¸‹ä¸¤ç§æ–¹å¼é€‰**å…¶ä¸€**ï¼š

**æ–¹å¼ A â€” `.env` æ–‡ä»¶ï¼ˆæ¨èï¼‰**

æŠŠè¿™è¡ŒåŠ åˆ°ä½ é¡¹ç›®çš„ `.env` æ–‡ä»¶ä¸­ï¼š

```
CORTEX_URL=http://localhost:21100
```

**æ–¹å¼ B â€” Shell é…ç½®æ–‡ä»¶**

```bash
echo 'export CORTEX_URL=http://localhost:21100' >> ~/.zshrc
source ~/.zshrc
```

### ç¬¬ 4 æ­¥ï¼šæµ‹è¯•ä¸€ä¸‹

1. å’Œä½ çš„æ™ºèƒ½ä½“èŠå¤©ï¼Œå‘Šè¯‰å®ƒä¸€äº›å€¼å¾—è®°ä½çš„ä¿¡æ¯ï¼š
   > *"æˆ‘æœ€å–œæ¬¢çš„ç¼–ç¨‹è¯­è¨€æ˜¯ Rustï¼Œæˆ‘åœ¨ Acme å…¬å¸å·¥ä½œã€‚"*

2. å¼€ä¸€ä¸ª**æ–°å¯¹è¯**ï¼Œé—®ï¼š
   > *"ä½ çŸ¥é“å…³äºæˆ‘çš„ä»€ä¹ˆï¼Ÿ"*

3. å¦‚æœæ™ºèƒ½ä½“æåˆ°äº† Rust å’Œ Acmeï¼Œä¸€åˆ‡å°±ç»‘å¥½äº†ï¼

ä½ ä¹Ÿå¯ä»¥åœ¨ OpenClaw é‡Œè¾“å…¥ `/cortex-status` æ£€æŸ¥è¿æ¥çŠ¶æ€ã€‚

### èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆ

æ’ä»¶é€šè¿‡ OpenClaw çš„ `register(api)` æ¥å£è‡ªåŠ¨æ³¨å†Œï¼š

| Hook | è§¦å‘æ—¶æœº | åŠŸèƒ½ |
|------|---------|------|
| `onBeforeResponse` | AI å›å¤å‰ | å¬å›ç›¸å…³è®°å¿†ï¼Œæ³¨å…¥ä¸ºä¸Šä¸‹æ–‡ |
| `onAfterResponse` | AI å›å¤å | æå–å¹¶ä¿å­˜é‡è¦ä¿¡æ¯ï¼ˆå³å‘å³å¿˜ï¼‰ |
| `onBeforeCompaction` | ä¸Šä¸‹æ–‡å‹ç¼©å‰ | ç´§æ€¥ä¿å­˜å…³é”®ä¿¡æ¯ï¼Œé˜²æ­¢ä¸¢å¤± |

è¿˜æ³¨å†Œäº†ä¸¤ä¸ªå·¥å…·ï¼š

| å·¥å…· | åŠŸèƒ½ |
|------|------|
| `cortex_recall` | æ™ºèƒ½ä½“å¯ä»¥æŒ‰éœ€æœç´¢è®°å¿† |
| `cortex_remember` | æ™ºèƒ½ä½“å¯ä»¥ä¸»åŠ¨å­˜å‚¨é‡è¦äº‹å® |

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

è®© Cortex å’Œ OpenClaw æ™ºèƒ½ä½“æŒä¹…è¿è¡Œï¼š

```bash
# 1. ç”¨ Docker è¿è¡Œ Cortexï¼ˆè‡ªåŠ¨é‡å¯ï¼Œæ•°æ®æŒä¹…åŒ–ï¼‰
OPENAI_API_KEY=sk-xxx docker compose up -d

# 2. å¯é€‰ï¼šè®¾ç½® auth token å¢å¼ºå®‰å…¨æ€§
echo 'CORTEX_AUTH_TOKEN=your-secret-token' >> .env
docker compose up -d  # é‡å¯ä½¿å…¶ç”Ÿæ•ˆ

# 3. åœ¨ä½ çš„ OpenClaw é¡¹ç›®ä¸­è®¾ç½® URL
echo 'CORTEX_URL=http://your-server-ip:21100' >> .env
```

> **æç¤ºï¼š** å¦‚æœ Cortex å’Œ OpenClaw åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œä½¿ç”¨ `http://localhost:21100`ã€‚å¦‚æœåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œæ›¿æ¢ä¸ºä½ çš„æœåŠ¡å™¨ IP æˆ–åŸŸåã€‚

### å¸¸è§é—®é¢˜æ’æŸ¥

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| æ™ºèƒ½ä½“ä¸å¬å›è®°å¿† | æ£€æŸ¥ `curl http://localhost:21100/api/v1/health` æ˜¯å¦è¿”å› OK |
| æ’ä»¶æ²¡æœ‰åŠ è½½ | è¿è¡Œ `openclaw plugins list` ç¡®è®¤ `@cortexmem/cortex-bridge` å·²å®‰è£… |
| å›å¤åä¸ä¿å­˜è®°å¿† | streaming æ¨¡å¼ä¸‹çš„å·²çŸ¥ä¸Šæ¸¸é—®é¢˜ â€” è§[å·²çŸ¥é—®é¢˜](#å·²çŸ¥é—®é¢˜) |
| è¿æ¥è¢«æ‹’ç» | ç¡®è®¤ `CORTEX_URL` å·²è®¾ç½®ä¸” Cortex æ­£åœ¨è¿è¡Œ |

---

## å·¥ä½œåŸç†

Cortex ä½¿ç”¨ä¸‰å±‚è®°å¿†æ¨¡å‹ï¼Œçµæ„Ÿæ¥æºäºäººç±»è®°å¿†çš„è¿ä½œæ–¹å¼ï¼š

```
å¯¹è¯ â†’ [å·¥ä½œè®°å¿†] â†’ [æ ¸å¿ƒè®°å¿†] â†’ [å½’æ¡£è®°å¿†]
          48 å°æ—¶       æ°¸ä¹…        90 å¤©
                                  â†“ å‹ç¼©
                              å›æµåˆ°æ ¸å¿ƒå±‚
```

| å±‚çº§ | å­˜æ´»æ—¶é—´ | å­˜å‚¨å†…å®¹ | ç±»æ¯” |
|------|---------|---------|------|
| **Working** | 48å°æ—¶ | è¿‘æœŸå¯¹è¯ä¸Šä¸‹æ–‡ | çŸ­æœŸè®°å¿† |
| **Core** | æ°¸ä¹… | å…³é”®äº‹å®ã€åå¥½ã€å†³ç­– | é•¿æœŸè®°å¿† |
| **Archive** | 90å¤© â†’ å‹ç¼©å›æµè‡³ Core | ä½é¢‘è®¿é—®æ¡ç›® | è¿œæœŸè®°å¿† |

**è®°å¿†æ°¸ä¸çœŸæ­£ä¸¢å¤±ã€‚** å½’æ¡£è®°å¿†ä¼šè¢«å‹ç¼©ä¸ºæ‘˜è¦ï¼Œæ°¸ä¹…ä¿ç•™åœ¨æ ¸å¿ƒå±‚ä¸­ã€‚

### è®°å¿†åˆ†ç±»

Cortex å°†è®°å¿†åˆ†ä¸º 20 ä¸ªç±»åˆ«ï¼ŒæŒ‰ä¸‰è½¨å½’å±ç»„ç»‡ï¼Œæ¯ä¸ªç±»åˆ«æœ‰ç‹¬ç«‹çš„é‡è¦æ€§å’Œè¡°å‡ç‡ï¼š

**ç”¨æˆ·è®°å¿†** â€” å…³äºç”¨æˆ·çš„äº‹å®ï¼š

| ç±»åˆ« | è¯´æ˜ | é‡è¦æ€§ |
|------|------|--------|
| `identity` | å§“åã€èŒä¸šã€è§’è‰²ã€æ‰€åœ¨åœ° | 0.9-1.0 |
| `preference` | å·¥å…·ã€å·¥ä½œæµã€é£æ ¼ã€ä¹ æƒ¯ | 0.8-0.9 |
| `correction` | å¯¹å·²çŸ¥ä¿¡æ¯çš„ä¿®æ­£æ›´æ–° | 0.9-1.0 |
| `skill` | ä¸“é•¿ã€ç†Ÿç»ƒåº¦ã€æŠ€æœ¯æ ˆ | 0.8-0.9 |
| `relationship` | åŒäº‹ã€æœ‹å‹ã€ç»„ç»‡å…³ç³» | 0.8-0.9 |
| `goal` | ç›®æ ‡ã€è®¡åˆ’ã€é‡Œç¨‹ç¢‘ | 0.7-0.9 |
| `decision` | å·²åšå‡ºçš„å…·ä½“å†³ç­– | 0.8-0.9 |
| `entity` | å·¥å…·ã€é¡¹ç›®ã€ç»„ç»‡ç­‰å‘½åå®ä½“ | 0.6-0.8 |
| `project_state` | é¡¹ç›®è¿›åº¦ã€çŠ¶æ€å˜æ›´ | 0.5-0.7 |
| `insight` | ç»éªŒæ•™è®­ã€æ´å¯Ÿ | 0.5-0.7 |
| `fact` | ç”¨æˆ·ç›¸å…³çš„äº‹å®ä¿¡æ¯ | 0.5-0.8 |
| `todo` | å¾…åŠäº‹é¡¹ã€è·Ÿè¿›ä»»åŠ¡ | 0.6-0.8 |

**æ“ä½œçº§** â€” è§„åˆ™ä¸ç­–ç•¥ï¼š

| ç±»åˆ« | è¯´æ˜ | é‡è¦æ€§ |
|------|------|--------|
| `constraint` | ä¸å¯è¿åçš„ç¡¬çº¦æŸï¼ˆ"ç¦æ­¢ X"ã€"never do Y"ï¼‰ | 0.9-1.0 |
| `policy` | æ‰§è¡Œç­–ç•¥/é»˜è®¤è¡Œä¸ºè§„èŒƒï¼ˆ"ä¼˜å…ˆç”¨ X å† Y"ï¼‰ | 0.7-0.9 |

**Agent æˆé•¿** â€” Agent è‡ªèº«çš„å­¦ä¹ ä¸è§‚å¯Ÿï¼š

| ç±»åˆ« | è¯´æ˜ | é‡è¦æ€§ |
|------|------|--------|
| `agent_persona` | Agent äººè®¾/é£æ ¼ï¼šè¯­æ°”ã€è§’è‰²å®šä½ã€ä¸ªæ€§ç‰¹å¾ | 0.8-1.0 |
| `agent_relationship` | ä¸ç”¨æˆ·çš„ç›¸å¤„æ¨¡å¼ï¼šäº’åŠ¨é»˜å¥‘ã€ä¿¡ä»»è¾¹ç•Œ | 0.8-0.9 |
| `agent_user_habit` | å¯¹ç”¨æˆ·ä¹ æƒ¯çš„è§‚å¯Ÿï¼šæ²Ÿé€šé£æ ¼ã€å·¥ä½œèŠ‚å¥ | 0.7-0.9 |
| `agent_self_improvement` | Agent è¡Œä¸ºæ”¹è¿›ï¼šé”™è¯¯æ¨¡å¼ã€æ›´å¥½çš„å¤„ç†æ–¹å¼ | 0.7-0.9 |

**ç³»ç»Ÿå†…éƒ¨**ï¼š

| ç±»åˆ« | è¯´æ˜ | é‡è¦æ€§ |
|------|------|--------|
| `context` | ä¼šè¯ä¸Šä¸‹æ–‡ | 0.2 |
| `summary` | å‹ç¼©æ‘˜è¦ | 0.4 |

### è®°å¿†æå–ï¼ˆMemory Sieveï¼‰

Memory Sieve ä½¿ç”¨**åŒé€šé“æå–**ç®¡çº¿ï¼Œç»“åˆ**ä¸‰è½¨å½’å±**ï¼š

1. **å¿«é€Ÿé€šé“** â€” åŸºäºæ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼åŒ¹é…ï¼ˆä¸­/è‹±/æ—¥ä¸‰è¯­ï¼‰ï¼Œé›¶ LLM å»¶è¿Ÿæ£€æµ‹é«˜ä¿¡å·ä¿¡æ¯
2. **æ·±åº¦é€šé“** â€” LLM é©±åŠ¨çš„ç»“æ„åŒ– JSON æå–ï¼Œè¾“å‡ºå¸¦æœ‰åˆ†ç±»ã€é‡è¦æ€§è¯„åˆ†ã€æ¨ç†ä¾æ®å’Œæ¥æºå½’å±çš„è®°å¿†

**ä¸‰è½¨å½’å±**å°†è®°å¿†è·¯ç”±åˆ°æ­£ç¡®çš„åˆ†ç±»ï¼š
- **ç”¨æˆ·è½¨** â€” ç”¨æˆ·è‡ªè¿°çš„äº‹å®ã€åå¥½ã€å†³ç­–
- **æ“ä½œè½¨** â€” ç”¨æˆ·æˆ–ç³»ç»Ÿè®¾å®šçš„çº¦æŸå’Œç­–ç•¥
- **Agent è½¨** â€” Agent è‡ªèº«çš„åæ€ã€è§‚å¯Ÿå’Œäººè®¾

ä¸¤ä¸ªé€šé“å¹¶è¡Œè¿è¡Œï¼Œç»“æœé€šè¿‡å‘é‡ç›¸ä¼¼åº¦äº¤å‰å»é‡ã€‚é‡è¦æ€§ â‰¥ 0.8 çš„è®°å¿†ç›´æ¥å†™å…¥æ ¸å¿ƒå±‚ï¼Œè¾ƒä½é‡è¦æ€§çš„å†™å…¥å·¥ä½œè®°å¿†ï¼ˆå¸¦ TTLï¼‰ã€‚

Sieve è¿˜æ”¯æŒ**ç”¨æˆ·ç”»åƒæ³¨å…¥** â€” ä»æ ¸å¿ƒè®°å¿†è‡ªåŠ¨åˆæˆç”¨æˆ·ç”»åƒï¼Œæ³¨å…¥åˆ°æå– prompt ä¸­ï¼Œå¸®åŠ© LLM é¿å…é‡å¤æå–å·²çŸ¥äº‹å®ï¼Œæ›´å¥½åœ°è¯†åˆ«å¢é‡æ–°ä¿¡æ¯ã€‚

### è®°å¿†ç”Ÿå‘½å‘¨æœŸ

ç”Ÿå‘½å‘¨æœŸå¼•æ“è‡ªåŠ¨è¿è¡Œï¼ˆå¯é…ç½®è°ƒåº¦è®¡åˆ’ï¼‰ï¼Œè´Ÿè´£ï¼š

- **æ™‹å‡**ï¼šé‡è¦çš„å·¥ä½œè®°å¿† â†’ æ ¸å¿ƒå±‚
- **åˆå¹¶**ï¼šé‡å¤/ç›¸ä¼¼çš„æ ¸å¿ƒè®°å¿† â†’ åˆå¹¶ä¸ºä¸€æ¡ä¸°å¯Œæ¡ç›®
- **å½’æ¡£**ï¼šè¡°å‡çš„æ ¸å¿ƒè®°å¿† â†’ å½’æ¡£å±‚
- **å‹ç¼©**ï¼šè¿‡æœŸçš„å½’æ¡£æ¡ç›® â†’ å‹ç¼©ä¸ºæ ¸å¿ƒå±‚æ‘˜è¦
- **ç”»åƒåˆæˆ**ï¼šä»æ ¸å¿ƒè®°å¿†è‡ªåŠ¨ç”Ÿæˆç”¨æˆ·ç”»åƒ

---

## æ¶æ„

```
â”Œâ”€ å®¢æˆ·ç«¯å±‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenClawï¼ˆæ¡¥æ¥ï¼‰â”‚ Claude Desktopï¼ˆMCPï¼‰â”‚ ä»»æ„å®¢æˆ·ç«¯ï¼ˆRESTï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼                      â–¼
â”Œâ”€ Cortex Server (:21100) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REST API â”‚ MCP Server â”‚ ç®¡ç†é¢æ¿                       â”‚
â”‚  Memory Gateï¼ˆæ£€ç´¢ï¼‰â”‚ Memory Sieveï¼ˆæå–ï¼‰               â”‚
â”‚  Memory Flush+ï¼ˆåˆ·æ–°ï¼‰â”‚ Lifecycle Engineï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰     â”‚
â”‚  SQLite + FTS5 â”‚ å‘é‡åç«¯ â”‚ Markdown å¯¼å‡ºå™¨             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœç´¢ï¼ˆå¬å›æµç¨‹ï¼‰

AI æ”¶åˆ°æ¶ˆæ¯æ—¶çš„å®Œæ•´å¬å›æµç¨‹ï¼š

```
ç”¨æˆ·æ¶ˆæ¯
  â”‚
  â–¼
æ¸…ç†æŸ¥è¯¢ï¼ˆå»é™¤ç³»ç»Ÿæ ‡ç­¾ã€metadataï¼‰
  â”‚
  â–¼
é—²èŠæ£€æµ‹ â”€â”€æ˜¯â”€â”€â†’ è·³è¿‡ï¼ˆä¸æœç´¢ï¼‰
  â”‚å¦
  â–¼
â”Œâ”€ æŸ¥è¯¢æ‰©å±•ï¼ˆ1æ¬¡LLMè°ƒç”¨ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  "æœåŠ¡å™¨æ€ä¹ˆéƒ¨ç½²çš„"                    â”‚
â”‚   â†’ å˜ä½“1: "æœåŠ¡å™¨éƒ¨ç½²æµç¨‹å’Œé…ç½®æ­¥éª¤"   â”‚
â”‚   â†’ å˜ä½“2: "åç«¯æœåŠ¡ä¸Šçº¿æ–¹å¼"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼  æ¯ä¸ªå˜ä½“ç‹¬ç«‹æœç´¢ï¼ˆæ— LLMï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚BM25å…¨æ–‡ â”‚    â”‚ å‘é‡è¯­ä¹‰  â”‚
â”‚å…³é”®è¯åŒ¹é…â”‚    â”‚embedding â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â””â”€â”€ RRF èåˆ â”€â”€â”˜
  å±‚çº§æƒé‡ Ã— æ—¶é—´è¡°å‡ Ã— è®¿é—®é¢‘ç‡ = finalScore
  â”‚
  â–¼
â”Œâ”€ åˆå¹¶å»é‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŒä¸€è®°å¿†è¢«å¤šå˜ä½“å‘½ä¸­ï¼š               â”‚
â”‚   â†’ ä¿ç•™æœ€é«˜ finalScore ä¸ºåŸºç¡€åˆ†      â”‚
â”‚   â†’ å¤šå‘½ä¸­å¯¹æ•°åŠ åˆ†: +8% Ã— ln(å‘½ä¸­æ•°)  â”‚
â”‚     2æ¬¡+5.5% / 3æ¬¡+8.8%             â”‚
â”‚  ç»“æœï¼šæ‰€æœ‰å˜ä½“çš„å¹¶é›†ï¼ˆçº¦30+æ¡ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€ LLM é‡æ’åºï¼ˆ1æ¬¡LLMè°ƒç”¨ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…¨éƒ¨åˆå¹¶ç»“æœ â†’ LLM é€æ¡æ‰“åˆ† 0~1     â”‚
â”‚  æœ€ç»ˆåˆ† = rerankeråˆ† Ã— w             â”‚
â”‚         + åŸå§‹åˆ†   Ã— (1-w)           â”‚
â”‚  w é»˜è®¤ 0.5ï¼Œå¯åœ¨ç®¡ç†é¢æ¿è°ƒèŠ‚         â”‚
â”‚  è¾“å‡ºï¼štop 15 æ¡                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
ä¼˜å…ˆæ³¨å…¥ constraint/persona
â†’ å¡«å……å‰©ä½™é¢„ç®— â†’ æ³¨å…¥ AI ä¸Šä¸‹æ–‡

å…± 2 æ¬¡ LLM è°ƒç”¨ï¼Œå»¶è¿Ÿçº¦ 5-7 ç§’
```

**æŸ¥è¯¢æ‰©å±•**ï¼ˆå¯é€‰ï¼‰ï¼šLLM å°†æŸ¥è¯¢æ”¹å†™ä¸º 2-3 ä¸ªå˜ä½“ï¼ˆåŒä¹‰è¯ã€ä¸åŒè¡¨è¿°ï¼‰ï¼Œåˆ†åˆ«æœç´¢ä»¥æ‰©å¤§å€™é€‰æ± ã€‚è¢«å¤šä¸ªå˜ä½“å‘½ä¸­çš„è®°å¿†è·å¾—å¯¹æ•°åŠ åˆ†ï¼ˆé€’å‡æ”¶ç›Šï¼‰ã€‚åœ¨ç®¡ç†é¢æ¿ â†’ Gate â†’ Query Expansion å¼€å¯ã€‚

**LLM é‡æ’åº**ï¼ˆå¯é€‰ï¼‰ï¼šåˆå¹¶æ‰€æœ‰å˜ä½“ç»“æœåï¼ŒLLM ç»Ÿä¸€é‡æ–°æ‰“åˆ†ã€‚æœ€ç»ˆåˆ†æ•°èåˆ reranker åˆ†å’ŒåŸå§‹åˆ†ï¼Œæƒé‡å¯é…ç½®ï¼ˆé»˜è®¤ 50:50ï¼‰ï¼Œä¿ç•™å±‚çº§ã€æ—¶é—´ã€è®¿é—®é¢‘ç‡ç­‰ä¿¡å·ã€‚æ”¯æŒ `llm`ï¼ˆå¤ç”¨æå–æ¨¡å‹ï¼‰å’Œ `cohere`ï¼ˆCohere Rerank APIï¼‰ã€‚åœ¨ç®¡ç†é¢æ¿ â†’ Search â†’ Reranker å¼€å¯ã€‚

**ä¼˜å…ˆæ³¨å…¥**ï¼šæ ¼å¼åŒ–æ³¨å…¥ä¸Šä¸‹æ–‡æ—¶ï¼Œ`constraint`ï¼ˆç¡¬çº¦æŸï¼‰å’Œ `agent_persona`ï¼ˆäººè®¾ï¼‰è®°å¿†ä¼˜å…ˆæ³¨å…¥ï¼Œç¡®ä¿å…³é”®è§„åˆ™å’Œäººè®¾ä¸ä¼šè¢« token é¢„ç®—æˆªæ–­ã€‚

### MCP å·¥å…·

é€šè¿‡ MCP è¿æ¥åï¼ŒAI è‡ªåŠ¨è·å¾—è¿™äº›å·¥å…·ï¼š

| å·¥å…· | åŠŸèƒ½ |
|------|------|
| `cortex_recall` | æœç´¢è®°å¿†ä¸Šä¸‹æ–‡ï¼ˆçº¦æŸå’Œäººè®¾ä¼˜å…ˆæ³¨å…¥ï¼‰ |
| `cortex_remember` | å­˜å‚¨è®°å¿†ï¼šç”¨æˆ·äº‹å®ã€çº¦æŸã€ç­–ç•¥æˆ– Agent è‡ªæˆ‘è§‚å¯Ÿ |
| `cortex_forget` | åˆ é™¤æˆ–ä¿®æ­£è®°å¿† |
| `cortex_search_debug` | è°ƒè¯•æœç´¢è¯„åˆ†è¯¦æƒ… |
| `cortex_stats` | è·å–è®°å¿†ç»Ÿè®¡ |

---

## æ”¯æŒçš„æä¾›å•†

### LLM æä¾›å•†

| æä¾›å•† | æ¨¡å‹ | å¤‡æ³¨ |
|--------|------|------|
| **OpenAI** | gpt-4o-mini, gpt-4.1-nano/mini, gpt-4o, o3/o4-mini | é»˜è®¤é€‰æ‹©ï¼Œæœ€ä½³æ€§ä»·æ¯” |
| **Anthropic** | claude-haiku-4-5, claude-sonnet-4-5, claude-opus-4-5 | æå–è´¨é‡æœ€é«˜ |
| **Google Gemini** | gemini-2.5-flash/pro, gemini-2.0-flash | AI Studio æœ‰å…è´¹é¢åº¦ |
| **DeepSeek** | deepseek-chat, deepseek-reasoner | æœ€ä¾¿å®œï¼ŒOpenAI å…¼å®¹ API |
| **OpenRouter** | 100+ æ¥è‡ªæ‰€æœ‰æä¾›å•†çš„æ¨¡å‹ | ç»Ÿä¸€ç½‘å…³ |
| **Ollama** | qwen2.5, llama3.2, mistral, deepseek-r1 ç­‰ | å®Œå…¨æœ¬åœ°ï¼Œæ— éœ€ API Key |

### Embedding æä¾›å•†

| æä¾›å•† | æ¨¡å‹ | å¤‡æ³¨ |
|--------|------|------|
| **OpenAI** | text-embedding-3-small/large | é»˜è®¤ï¼ˆ1536ç»´ï¼‰ï¼Œæœ€ç¨³å®š |
| **Google Gemini** | gemini-embedding-001, text-embedding-004 | AI Studio å…è´¹ |
| **Voyage AI** | voyage-3, voyage-3-lite, voyage-code-3 | é«˜è´¨é‡ |
| **Ollama** | bge-m3, nomic-embed-text, mxbai-embed-large | æœ¬åœ°è¿è¡Œï¼Œé›¶æˆæœ¬ |

æ‰€æœ‰æä¾›å•†éƒ½å¯é€šè¿‡ç®¡ç†é¢æ¿ UI æˆ– `cortex.json` é…ç½®ã€‚è¯¦ç»†çš„æ¨¡å‹å¯¹æ¯”å’Œå®šä»·è¯·å‚è€ƒ `cortex-provider-reference.md`ã€‚

> **æ³¨æ„ï¼šæ›´æ¢ Embedding æ¨¡å‹**
>
> æ¯ä¸ª Embedding æ¨¡å‹ç”Ÿæˆç‰¹å®šç»´åº¦çš„å‘é‡ã€‚å¦‚æœåˆ‡æ¢åˆ°ç»´åº¦ä¸åŒçš„æ¨¡å‹ï¼Œ**æ‰€æœ‰å·²æœ‰å‘é‡å°†ä¸å…¼å®¹**ã€‚æ›´æ¢ Embedding æ¨¡å‹æˆ–ç»´åº¦åï¼š
> 1. è¿›å…¥ç®¡ç†é¢æ¿ â†’ è®¾ç½® â†’ æ•°æ®ç®¡ç† â†’ **é‡å»ºå‘é‡ç´¢å¼•**
> 2. ç³»ç»Ÿä¼šä½¿ç”¨æ–°æ¨¡å‹é‡æ–°ç”Ÿæˆæ‰€æœ‰å‘é‡ï¼ˆæ¯æ¡è®°å¿†éƒ½éœ€è¦è°ƒç”¨ APIï¼‰
> 3. æœªé‡å»ºå‰ï¼Œå‘é‡æœç´¢ï¼ˆå¬å›ã€å»é‡ã€æ™ºèƒ½æ›´æ–°ï¼‰å°†æ— æ³•æ­£å¸¸å·¥ä½œ

---

## API å‚è€ƒ

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| `POST` | `/api/v1/recall` | æœç´¢ç›¸å…³è®°å¿†ï¼Œè¿”å›æ³¨å…¥ä¸Šä¸‹æ–‡ |
| `POST` | `/api/v1/ingest` | æ‘„å…¥å¯¹è¯ï¼Œè‡ªåŠ¨æå–è®°å¿† |
| `POST` | `/api/v1/flush` | ç´§æ€¥åˆ·æ–°ï¼ˆCompaction å‰ä¿æŠ¤ä¸Šä¸‹æ–‡ï¼‰ |
| `POST` | `/api/v1/search` | æ··åˆæœç´¢ï¼ˆæ”¯æŒè°ƒè¯•ä¿¡æ¯ï¼‰ |
| `GET/POST/PATCH/DELETE` | `/api/v1/memories` | è®°å¿† CRUD |
| `GET/POST/DELETE` | `/api/v1/relations` | å®ä½“å…³ç³» CRUD |
| `GET/POST/PATCH/DELETE` | `/api/v1/agents` | æ™ºèƒ½ä½“ç®¡ç† |
| `GET` | `/api/v1/agents/:id/config` | æ™ºèƒ½ä½“åˆå¹¶é…ç½® |
| `GET` | `/api/v1/extraction-logs` | æå–è´¨é‡å®¡æŸ¥æ—¥å¿— |
| `POST` | `/api/v1/lifecycle/run` | æ‰‹åŠ¨è§¦å‘ç”Ÿå‘½å‘¨æœŸå¼•æ“ |
| `GET` | `/api/v1/lifecycle/preview` | é¢„è§ˆï¼ˆdry-runï¼‰ |
| `GET` | `/api/v1/health` | å¥åº·æ£€æŸ¥ |
| `GET` | `/api/v1/stats` | è®°å¿†ç»Ÿè®¡ |
| `GET/PATCH` | `/api/v1/config` | é…ç½®ç®¡ç† |

---

## é…ç½®

Cortex åªéœ€ä¸€ä¸ª `OPENAI_API_KEY` å³å¯å¼€ç®±å³ç”¨ã€‚è¿›é˜¶é…ç½®ï¼š

| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| **LLM æä¾›å•†** | OpenAIã€Anthropicã€Google Geminiã€DeepSeekã€OpenRouterã€Ollama |
| **Embedding æä¾›å•†** | OpenAIã€Googleã€Voyage AIã€Ollama |
| **å‘é‡åç«¯** | SQLite vec0ï¼ˆé»˜è®¤ï¼‰ã€Qdrantã€Milvus |
| **æ™ºèƒ½ä½“ç‹¬ç«‹é…ç½®** | æ¯ä¸ªæ™ºèƒ½ä½“å¯è¦†ç›–å…¨å±€ LLM/Embedding è®¾ç½® |
| **ç¦»çº¿æ¨¡å¼** | ä½¿ç”¨ Ollama å®ç°å®Œå…¨æœ¬åœ°åŒ–ï¼Œæ— éœ€ API Key |

å®Œæ•´é…ç½®é€‰é¡¹è¯·å‚è€ƒ `DESIGN.md`ï¼Œæä¾›å•†é€‰æ‹©æŒ‡å—è¯·å‚è€ƒ `cortex-provider-reference.md`ã€‚

---

## é¡¹ç›®ç»“æ„

```
cortex/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ server/          # æ ¸å¿ƒæœåŠ¡ï¼ˆFastify + SQLiteï¼‰
â”‚   â”œâ”€â”€ mcp-client/      # MCP stdio é€‚é…å™¨ï¼ˆnpm: @cortex/mcp-clientï¼‰
â”‚   â”œâ”€â”€ cortex-bridge/   # OpenClaw æ’ä»¶ï¼ˆnpm: @cortexmem/cortex-bridgeï¼‰
â”‚   â””â”€â”€ dashboard/       # React ç®¡ç†é¢æ¿
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ DESIGN.md            # å®Œæ•´æŠ€æœ¯è®¾è®¡æ–‡æ¡£
â””â”€â”€ cortex-provider-reference.md  # LLM/Embedding æä¾›å•†é€‰æ‹©æŒ‡å—
```

## æˆæœ¬

ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆgpt-4o-mini + text-embedding-3-smallï¼‰ï¼š
- æ¯å¤© 50 è½®å¯¹è¯çº¦ **$0.55/æœˆ**
- çº¿æ€§å¢é•¿ï¼Œ3 å€ä½¿ç”¨é‡ä¹Ÿä¸åˆ° $2/æœˆ
- ä½¿ç”¨ DeepSeek + Google Embeddingï¼šä½è‡³ **~$0.10/æœˆ**

## å·²çŸ¥é—®é¢˜

### ~~OpenClawï¼šstreaming æ¨¡å¼ä¸‹ `agent_end` hook ä¸è§¦å‘~~ ï¼ˆå·²ä¿®å¤ï¼‰

~~**ä¸Šæ¸¸ bugï¼š** [openclaw/openclaw#21863](https://github.com/openclaw/openclaw/issues/21863)~~

**å·²è§£å†³** â€” ä¸Šæ¸¸å·²åœ¨ commit `72d1d36` ä¸­ä¿®å¤ã€‚`agent_end` hook ç°åœ¨åœ¨ streaming æ¨¡å¼ä¸‹ä¹Ÿèƒ½æ­£å¸¸è§¦å‘ï¼Œè‡ªåŠ¨è®°å¿†æå–åœ¨æ‰€æœ‰æ¨¡å¼ä¸‹å‡å¯æ­£å¸¸å·¥ä½œã€‚

## å¼€æºåè®®

MIT
